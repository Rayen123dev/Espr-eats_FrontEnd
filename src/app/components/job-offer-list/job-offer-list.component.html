<div class="subscription-container">
  <!-- Modern Banner -->
  <div class="modern-banner">
    <div class="banner-content">
      <h1 class="banner-title">Trouvez l'emploi de vos rÃªves</h1>
      <p class="banner-subtitle">Explorez les opportunitÃ©s qui correspondent Ã  vos compÃ©tences et objectifs de carriÃ¨re</p>

      <div class="banner-stats">
        <div class="banner-stat">
          <div class="banner-stat-value">{{ filteredOffers.length }}</div>
          <div class="banner-stat-label">Emplois actifs</div>
        </div>
        <div class="banner-stat">
          <div class="banner-stat-value">{{ getCompaniesCount() }}</div>
          <div class="banner-stat-label">Entreprises</div>
        </div>
        <div class="banner-stat">
          <div class="banner-stat-value">{{ getSkillsCount() }}</div>
          <div class="banner-stat-label">CompÃ©tences recherchÃ©es</div>
        </div>
      </div>

      <div class="banner-search">
        <input type="text" placeholder="Rechercher des titres d'emploi, compÃ©tences ou mots-clÃ©s..." [(ngModel)]="titleFilter" (input)="searchSubject.next('')">
        <button (click)="applyFilter()">Rechercher</button>
      </div>
    </div>
    <div class="banner-image">
      <div class="banner-shape"></div>
    </div>
  </div>

  <!-- Wishlist Toggle Button -->
  <div class="wishlist-toggle-container">
    <button class="wishlist-toggle-btn" [class.active]="showWishlistSection" (click)="toggleWishlistSection()">
      â¤ {{ showWishlistSection ? 'Affichage des emplois sauvegardÃ©s' : 'Voir mes emplois sauvegardÃ©s' }}
    </button>
  </div>

  <div class="row">
    <!-- Filters Column -->
    <div class="filter-section col-3">
      <h3>ğŸ” Filtrer les offres d'emploi</h3>

      <label for="titleFilter">ğŸ“ Titre :</label>
      <input type="text" id="titleFilter" [(ngModel)]="titleFilter" (input)="searchSubject.next('')" class="form-control mb-2">

      <label for="minDate">ğŸ“… Date limite min :</label>
      <input type="date" id="minDate" [(ngModel)]="minDate" (change)="applyFilter()" class="form-control mb-2">

      <label for="maxDate">ğŸ“… Date limite max :</label>
      <input type="date" id="maxDate" [(ngModel)]="maxDate" (change)="applyFilter()" class="form-control mb-2">

      <label for="skillsFilter">ğŸ”§ CompÃ©tences :</label>
      <input type="text" id="skillsFilter" [(ngModel)]="skillsFilter" (input)="searchSubject.next('')" class="form-control mb-3">

      <button class="saved-jobs-filter-btn mb-3" [class.active]="showSavedOnly" (click)="toggleSavedJobsFilter()">
        â˜…
        {{ showSavedOnly ? 'Affichage des emplois sauvegardÃ©s' : 'Afficher les emplois sauvegardÃ©s' }}
      </button>

      <div class="text-center">
        <button (click)="resetFilters()" class="reset-filters-btn">
          ğŸ”„ RÃ©initialiser les filtres
        </button>
      </div>
    </div>

    <!-- Offers Column -->
    <div class="col-9">
      <div id="offers-container" class="plans-container">
        <div *ngFor="let offer of paginatedOffers" class="plan-card">
          <div class="job-offer-image-container" *ngIf="offer.image">
            <img [src]="offer.image" alt="Job Image" class="job-offer-image">
          </div>
          <h3>{{ offer.title }}</h3>
          <p class="description">{{ offer.jobDescription }}</p>
          <p class="subscription-info" [class.expired]="isJobExpired(offer)">
            <strong>Date limite:</strong> {{ offer.date | date: 'shortDate' }}
            <span *ngIf="isJobExpired(offer)" class="expired-badge">ExpirÃ©</span><br>
            <strong>CompÃ©tences:</strong> {{ offer.skills }}
          </p>

          <!-- Action Buttons -->
          <div class="job-action-buttons">
            <!-- Save Job Button -->
            <button
              class="btn-save-job"
              (click)="toggleSaveJob(offer); $event.stopPropagation();"
              [class.saved]="isJobSaved(offer)"
              title="{{ isJobSaved(offer) ? 'Retirer des emplois sauvegardÃ©s' : 'Sauvegarder cet emploi' }}"
            >
              â˜…
            </button>

            <!-- Share Job Button -->
            <button
              class="btn-share-job"
              (click)="shareJob(offer); $event.stopPropagation();"
              title="Partager cet emploi"
            >
              â†—
            </button>
          </div>

          <!-- Apply Button -->
          <button
            class="subscribe-button"
            (click)="selectOffer(offer)"
            [disabled]="appliedOffers.has(offer.jobOfferId!) || isJobExpired(offer)"
            [class.expired-btn]="isJobExpired(offer)"
          >
            {{ appliedOffers.has(offer.jobOfferId!) ? 'âœ“' : isJobExpired(offer) ? 'â±' : 'âœ‰' }}
            {{ appliedOffers.has(offer.jobOfferId!) ? 'DÃ©jÃ  postulÃ©' : isJobExpired(offer) ? 'Date limite dÃ©passÃ©e' : 'Postuler maintenant' }}
          </button>

          <!-- Ask AI Button -->
          <button class="btn-ai-career mt-2" (click)="openAIModal()">
            ğŸ¤– Assistant de carriÃ¨re IA
          </button>

        </div>
      </div>

      <div *ngIf="paginatedOffers.length > 0" class="pagination-container mt-4">
        <button
          *ngFor="let page of getPageNumbers()"
          (click)="changePage(page)"
          class="pagination-btn"
          [class.active]="page === currentPage"
        >
          {{ page }}
        </button>
      </div>

      <ng-template #noOffers>
        <p>No job offers found.</p>
      </ng-template>
    </div>
  </div>

  <!-- Apply Modal -->
  <div *ngIf="selectedOffer" class="modal show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <form [formGroup]="applicationForm" (ngSubmit)="submitApplication()">
          <div class="modal-header">
            <h5 class="modal-title text-dark">Postuler pour {{ selectedOffer.title }}</h5>
            <div class="modal-actions">
              <button type="button" class="btn-icon" title="Save this job" (click)="toggleSaveJob(selectedOffer)">
                â˜…
              </button>
              <button type="button" class="btn-icon" title="Share this job" (click)="shareJob(selectedOffer)">
                â†—
              </button>
              <button type="button" class="btn-close" (click)="selectedOffer = null">âœ•</button>
            </div>
          </div>
          <div class="modal-body">
            <div class="job-details mb-4">
              <h6 class="text-primary">DÃ©tails de l'emploi:</h6>
              <p><strong>Titre:</strong> {{ selectedOffer.title }}</p>
              <p><strong>Description:</strong> {{ selectedOffer.jobDescription }}</p>
              <p><strong>CompÃ©tences requises:</strong> {{ selectedOffer.skills }}</p>
              <p><strong>Date limite de candidature:</strong> {{ selectedOffer.date | date: 'mediumDate' }}</p>
            </div>
            <hr>
            <h6 class="text-primary mb-3">Votre candidature:</h6>
            <div class="mb-3">
              <label>TÃ©lÃ©charger lettre de motivation (PDF uniquement)</label>
              <input type="file" (change)="onMotivationFileSelected($event)" class="form-control" accept="application/pdf">
            </div>
            <div class="mb-3">
              <label>TÃ©lÃ©charger CV (PDF uniquement)</label>
              <input type="file" (change)="onCVFileSelected($event)" class="form-control" accept="application/pdf">
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success" [disabled]="applicationForm.invalid">
              âœ‰ Soumettre la candidature
            </button>
            <button type="button" class="btn btn-secondary" (click)="selectedOffer = null">
              âœ• Annuler
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Advanced Career Services Section -->
  <hr class="my-4">

  <div class="advanced-services-section">
    <h2 class="text-center mb-4">AccÃ©lÃ©rez votre Ã©volution professionnelle</h2>
    <p class="text-center services-subtitle">Services professionnels pour vous dÃ©marquer sur le marchÃ© du travail</p>

    <div class="services-container">
      <div class="service-card" *ngFor="let service of services" [class.popular]="service.popular">
        <div class="service-icon">
          {{ service.icon === 'fa-file-text-o' ? 'ğŸ“„' :
             service.icon === 'fa-comments-o' ? 'ğŸ’¬' :
             service.icon === 'fa-road' ? 'ğŸ›£ï¸' :
             service.icon === 'fa-linkedin-square' ? 'ğŸ”—' :
             service.icon === 'fa-money' ? 'ğŸ’°' :
             service.icon === 'fa-id-card-o' ? 'ğŸªª' : 'ğŸ“‹' }}
        </div>
        <div class="service-content">
          <span *ngIf="service.popular" class="popular-badge">Popular</span>
          <h3 class="service-title">{{ service.title }}</h3>
          <p class="service-description">{{ service.description }}</p>
          <div class="service-footer">
            <span class="service-price">{{ service.price }}</span>
            <button class="service-button" (click)="requestService(service.title)">
              <span>â†’</span>
              <span>Commencer</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Career Assistant Modal (chat style) -->
  <div *ngIf="aiModalOpen" class="modal show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content ai-modal-content">
        <div class="ai-modal-header">
          <div class="ai-assistant-info">
            <div class="ai-avatar">
              ğŸ¤–
            </div>
            <div class="ai-title">
              <h5>Coach de carriÃ¨re IA</h5>
              <span>PropulsÃ© par l'IA avancÃ©e</span>
            </div>
          </div>
          <button type="button" class="ai-close-btn" aria-label="Close" (click)="closeAIModal()">
            âœ•
          </button>
        </div>

        <div class="ai-modal-body">
          <!-- AI Tips Section -->
          <div class="ai-tips" *ngIf="!aiResponse">
            <h6>ğŸ’¡ Comment je peux vous aider</h6>
            <ul>
              <li>âœ“ Analyser et amÃ©liorer votre CV</li>
              <li>âœ“ PrÃ©parer vos entretiens avec des questions pratiques</li>
              <li>âœ“ Fournir des conseils sur votre parcours professionnel</li>
              <li>âœ“ Offrir des stratÃ©gies de nÃ©gociation salariale</li>
              <li>âœ“ Aider avec vos documents de candidature</li>
            </ul>
          </div>

          <!-- AI Response Chat Bubble -->
          <div *ngIf="aiResponse" class="ai-chat-container">
            <div class="ai-message">
              <div class="ai-message-avatar">
                ğŸ¤–
              </div>
              <div class="ai-message-content">
                {{ aiResponse }}
              </div>
            </div>
          </div>

          <!-- Loading Indicator -->
          <div *ngIf="isLoading" class="ai-loading">
            <div class="ai-loading-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <p>Analyse de votre demande...</p>
          </div>

          <!-- User Input Chat -->
          <div class="ai-input-container">
            <textarea
              [(ngModel)]="aiInput"
              rows="3"
              class="ai-input"
              placeholder="Demandez des conseils sur votre CV, des astuces pour les entretiens, ou collez votre CV pour analyse..."
              [disabled]="isLoading"
            ></textarea>

            <div class="ai-actions">
              <button class="ai-voice-btn" (click)="startRecording()" [disabled]="isRecording || isLoading">
                ğŸ¤
                {{ isRecording ? 'Enregistrement...' : 'EntrÃ©e vocale' }}
              </button>
              <button class="ai-send-btn" (click)="sendToGroq()" [disabled]="isLoading || (!aiInput.trim())">
                âœ‰
                {{ isLoading ? 'Traitement...' : 'Envoyer' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
