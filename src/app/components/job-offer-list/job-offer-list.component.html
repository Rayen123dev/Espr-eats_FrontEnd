<div class="subscription-container">
  <h6 class="pricing-smalltitle"><span>Discover your next opportunity .</span></h6>
  <h2 class="pricing-title">Job Offers</h2>

  <div class="greeting-message">
    Welcome! Browse through our exciting offers and apply for your dream job today!
  </div>

  <div class="row">
    <!-- Filters Column -->
    <div class="filter-section col-3">
      <h3><i class="fas fa-filter"></i> Filter Job Offers</h3>

      <label for="titleFilter"><i class="fas fa-heading"></i> Title :</label>
      <input type="text" id="titleFilter" [(ngModel)]="titleFilter" (input)="applyFilter()" class="form-control mb-2">

      <label for="minDate"><i class="fas fa-calendar-minus"></i> Min Deadline :</label>
      <input type="date" id="minDate" [(ngModel)]="minDate" (change)="applyFilter()" class="form-control mb-2">

      <label for="maxDate"><i class="fas fa-calendar-plus"></i> Max Deadline :</label>
      <input type="date" id="maxDate" [(ngModel)]="maxDate" (change)="applyFilter()" class="form-control mb-2">

      <label for="skillsFilter"><i class="fas fa-tools"></i> Skills :</label>
      <input type="text" id="skillsFilter" [(ngModel)]="skillsFilter" (input)="applyFilter()" class="form-control mb-3">

      <button (click)="resetFilters()" class="btn btn-secondary w-100">
        <i class="fas fa-undo"></i> Reset Filters
      </button>
    </div>

    <!-- Offers Column -->
    <div class="col-9">
      <div id="offers-container" class="plans-container">
        <div *ngFor="let offer of paginatedOffers" class="plan-card">
          <div class="job-offer-image-container" *ngIf="offer.image">
            <img [src]="offer.image" alt="Job Image" class="job-offer-image">
          </div>
          <h3>{{ offer.title }}</h3>
          <p class="description">{{ offer.jobDescription }}</p>
          <p class="subscription-info">
            <strong>Deadline:</strong> {{ offer.date | date: 'shortDate' }}<br>
            <strong>Skills:</strong> {{ offer.skills }}
          </p>
          <button
            class="subscribe-button"
            (click)="selectOffer(offer)"
            [disabled]="appliedOffers.has(offer.jobOfferId!)"
          >
            {{ appliedOffers.has(offer.jobOfferId!) ? 'Already Applied' : 'Apply' }}
          </button>
        </div>
      </div>

      <div *ngIf="paginatedOffers.length > 0" class="d-flex justify-content-center mt-4">
        <button
          *ngFor="let page of getPageNumbers()"
          (click)="changePage(page)"
          class="btn btn-outline-primary mx-1"
          [class.active]="page === currentPage"
        >
          {{ page }}
        </button>
      </div>

      <ng-template #noOffers>
        <p>No job offers found.</p>
      </ng-template>
    </div>
  </div>

  <div *ngIf="selectedOffer" class="modal show d-block" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form [formGroup]="applicationForm" (ngSubmit)="submitApplication()">
          <div class="modal-header">
            <h5 class="modal-title">Apply for {{ selectedOffer.title }}</h5>
            <button type="button" class="btn-close" (click)="selectedOffer = null"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label>Upload Motivation Letter (PDF only)</label>
              <input type="file" (change)="onMotivationFileSelected($event)" class="form-control" accept="application/pdf">
            </div>
            <div class="mb-3">
              <label>Upload CV (PDF only)</label>
              <input type="file" (change)="onCVFileSelected($event)" class="form-control" accept="application/pdf">
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success" [disabled]="applicationForm.invalid">
              Submit Application
            </button>
            <button type="button" class="btn btn-secondary" (click)="selectedOffer = null">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
