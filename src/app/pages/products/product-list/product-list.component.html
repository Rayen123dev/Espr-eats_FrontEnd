<!-- Sidebar Section -->
<div class="deznav">
  <div class="deznav-scroll">
    <a class="add-project-sidebar btn btn-primary" href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#addProjectSidebar">+ New Project</a>
    <ul class="metismenu" id="menu">
      <li><a href="#">
        <i class="flaticon-layout"></i>
        <span class="nav-text">Dashboard</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-monitor"></i>
        <span class="nav-text">Apps</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-bar-chart-1"></i>
        <span class="nav-text">Charts</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-web"></i>
        <span class="nav-text">Bootstrap</span>
      </a></li>
      <li><a routerLink="/produits-dashboard" routerLinkActive="active">
        <i class="flaticon-plugin"></i>
        <span class="nav-text">Products</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-admin"></i>
        <span class="nav-text">Widget</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-contract"></i>
        <span class="nav-text">Forms</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-table"></i>
        <span class="nav-text">Table</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-newsletter"></i>
        <span class="nav-text">Pages</span>
      </a></li>
    </ul>
  </div>
</div>
<!-- Alert Box (Outside of Container) -->
<div class="alert-box show" *ngIf="alerts.length > 0">
  <button class="close-btn" (click)="hideAlerts()">âœ–</button>
  <h3>
    <i class="fas fa-exclamation-triangle alert-icon"></i>
    Product Alerts
  </h3>
  <ul>
    <li *ngFor="let alert of alerts">
      <i class="fas fa-exclamation-triangle alert-icon"></i>
      {{ alert.nomProduit }} (ID: {{ alert.produitID }}) - {{ alert.status }}
    </li>
  </ul>
</div>

<div class="container">
  <!-- Product Table -->
  <div class="content-container">
    <h2 class="title"><i class="fas fa-boxes"></i> Product List</h2>
    
    <div class="button-container">
      <button mat-raised-button color="primary" (click)="openProductForm(null)" class="space-button">
        <i class="fas fa-plus"></i> Add Product
      </button>
      <button mat-raised-button color="accent" [routerLink]="'/produit-historique'" class="space-button">
        <i class="fas fa-history"></i> View Product History
      </button>
      <button (click)="fileInput.click()" class="space-button">
        <i class="fas fa-barcode"></i> Upload Barcode
      </button>
      <input #fileInput type="file" style="display: none" (change)="onFileChange($event)" />
    </div>
        
    <div class="scrollable-table-container">
      <table class="center-table">
        <thead>
          <tr>
            <th> ID</th>
            <th>Barcode</th>
            <th> Name</th>
            <th> Description</th>
            <th> Alert Threshold</th>
            <th> Quantity</th>
            <th> Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of filteredProducts">
            <td>{{ product.produitID }}</td>
            <td>{{ product.barcode }}</td>
            <td>{{ product.nomProduit }}</td>
            <td>{{ product.description }}</td>
            <td>{{ product.seuil_alerte }}</td>
            <td>{{ product.quantite }}</td>
            <td>
              <button *ngIf="product.produitID !== undefined" (click)="deleteProduct(product.produitID)" style="margin-right: 10px;">
                <i class="fas fa-trash"></i>
              </button>
              <button mat-raised-button color="primary" (click)="openProductForm(product)">
                <i class="fas fa-edit"></i> Edit
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Success & Error Messages -->
  <div *ngIf="successMessage" class="alert alert-success" role="alert">
    <i class="fas fa-check-circle"></i> {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    <i class="fas fa-times-circle"></i> {{ errorMessage }}
  </div>

  <!-- Filter Section -->
  <div class="filter-section">
    <h3><i class="fas fa-filter"></i> Filter Products</h3>
    
    <label for="nameFilter"><i class="fas fa-box"></i> Name:</label>
    <input type="text" id="nameFilter" [(ngModel)]="nameFilter" (input)="applyFilter()">
    
    <label for="minQuantity"><i class="fas fa-sort-amount-down"></i> Min Quantity:</label>
    <input type="number" id="minQuantity" [(ngModel)]="minQuantity" (input)="applyFilter()">
    
    <label for="maxQuantity"><i class="fas fa-sort-amount-up"></i> Max Quantity:</label>
    <input type="number" id="maxQuantity" [(ngModel)]="maxQuantity" (input)="applyFilter()">
        
    <label for="alertThreshold"><i class="fas fa-bell"></i> Alert Threshold:</label>
    <input type="number" id="alertThreshold" [(ngModel)]="alertThreshold" (input)="applyFilter()">
    
    <label for="barcodeFilter"><i class="fas fa-barcode"></i> Barcode:</label>
    <input type="text" id="barcodeFilter" [(ngModel)]="barcodeFilter" (input)="applyFilter()">
    
    <button (click)="resetFilters()">
      <i class="fas fa-undo"></i> Reset Filters
    </button>
  </div>
</div>
