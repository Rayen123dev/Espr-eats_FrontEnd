<div class="deznav">
  <div class="deznav-scroll">
    <a class="add-project-sidebar btn btn-primary" href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#addProjectSidebar">+ New Project</a>
    <ul class="metismenu" id="menu">
      <li><a href="#">
        <i class="flaticon-layout"></i>
        <span class="nav-text">Dashboard</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-monitor"></i>
        <span class="nav-text">Apps</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-bar-chart-1"></i>
        <span class="nav-text">Charts</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-web"></i>
        <span class="nav-text">Bootstrap</span>
      </a></li>
      <li><a routerLink="/produits-dashboard" routerLinkActive="active">
        <i class="flaticon-plugin"></i>
        <span class="nav-text">Products</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-admin"></i>
        <span class="nav-text">Widget</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-contract"></i>
        <span class="nav-text">Forms</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-table"></i>
        <span class="nav-text">Table</span>
      </a></li>
      <li><a href="#">
        <i class="flaticon-newsletter"></i>
        <span class="nav-text">Pages</span>
      </a></li>
    </ul>
  </div>
</div>
<div class="container">
  <!-- Product History Table (Inside Content Container) -->
  <div class="content-container">
    <div class="product-history-header">
      <h2 class="title"><i class="fas fa-history"></i> Product History</h2>
      <div class="button-container">
        <!-- Back to Product List Button -->
        <button mat-raised-button 
                color="primary" 
                [routerLink]="'/product-list'" 
                class="action-button back-button">
          <i class="fas fa-arrow-left"></i> Back to Product List
        </button>

        <!-- Export to PDF Button -->
        <button mat-raised-button 
                color="warn" 
                (click)="exportToPDF()" 
                class="action-button export-button">
          <i class="fas fa-file-pdf"></i> Export to PDF
        </button>
      </div>
    </div>

    <!-- Product History Table -->
    <div class="scrollable-table-container">
      <table class="center-table">
        <thead>
          <tr>
            <th> ID</th>
            <th> Barcode</th>
            <th> Product Name</th>
            <th> Type</th>
            <th> Quantity</th>
            <th> Date</th>
            <th> Expiration Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let historique of filteredHistoriqueList">
            <td>{{ historique.historiqueID }}</td>
            <td>{{ historique.produit?.barcode }}</td>
            <td>{{ historique.produit?.nomProduit || 'No Product' }}</td>
            <td>{{ getTransactionType(historique.type) }}</td>
            <td>{{ historique.quantite }}</td>
            <td>{{ historique.date | date: 'short' }}</td>
            <td>
              <ng-container *ngIf="historique.produit?.date_peremption; else noExpiration">
                {{ historique.produit?.date_peremption | date: 'short' }}
              </ng-container>
              <ng-template #noExpiration>No expiration</ng-template>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Filter Section (Inside the same container but after the table) -->
  <div class="filter-section">
    <h3><i class="fas fa-filter"></i> Filter History</h3>

    <!-- Type Filter -->
    <label for="typeFilter"><i class="fas fa-exchange-alt"></i> Type:</label>
    <input type="text" id="typeFilter" [(ngModel)]="typeFilter" (input)="applyFilter()" placeholder="Filter by type">
    
    <!-- Barcode Filter -->
    <label for="barcodeFilter"><i class="fas fa-barcode"></i> Barcode:</label>
    <input type="text" id="barcodeFilter" [(ngModel)]="barcodeFilter" (input)="applyFilter()" placeholder="Enter Barcode">

    <!-- Min Quantity Filter -->
    <label for="minQuantiteFilter"><i class="fas fa-sort-amount-down"></i> Min Quantity:</label>
    <input type="number" id="minQuantiteFilter" [(ngModel)]="minQuantiteFilter" (input)="applyFilter()" placeholder="Min Quantity">

    <!-- Max Quantity Filter -->
    <label for="maxQuantiteFilter"><i class="fas fa-sort-amount-up"></i> Max Quantity:</label>
    <input type="number" id="maxQuantiteFilter" [(ngModel)]="maxQuantiteFilter" (input)="applyFilter()" placeholder="Max Quantity">

    <!-- Start Date Filter -->
    <label for="startDateFilter"><i class="fas fa-calendar-plus"></i> Start Date:</label>
    <input type="date" id="startDateFilter" [(ngModel)]="startDateFilter" (change)="applyFilter()">

    <!-- End Date Filter -->
    <label for="endDateFilter"><i class="fas fa-calendar-minus"></i> End Date:</label>
    <input type="date" id="endDateFilter" [(ngModel)]="endDateFilter" (change)="applyFilter()">

    <!-- Reset Filters Button -->
    <button mat-raised-button color="warn" (click)="resetFilters()">
      <i class="fas fa-undo"></i> Reset Filters
    </button>
  </div>
</div>
